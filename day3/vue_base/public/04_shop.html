<!DOCTYPE html>
<html>
    <head>
        <script src="./lib/vue.js"></script>
    </head>
    <body>
        <div id="app">
            å•†åº—
            <ul>
                <li v-bind:key="goods.id" v-for="goods of goods_list">
                    {{ goods.name }}, å•ä»·: {{ goods.price }} å•ä½{{ goods.unit}}, å¤–è§‚: {{goods.pic}}
                    <button @click="addGodosToCart(goods)">æ”¾å…¥è´­ç‰©è½¦</button>
                </li>
            </ul>

            è´­ç‰©è½¦:
            <ul>
                <li v-for="item of cart">
                        <input type="checkbox" v-model="buyItems"  v-bind:value="item" />
                        {{ item.name }}, å•ä»·: {{ item.price }} å•ä½{{ item.unit}}, 
                        å¤–è§‚: {{item.pic}}, 
                        æ•°é‡: 
                        <button v-on:click="decCount(item)">-</button>
                        <input v-on:input="changeCount(item, $event)" v-bind:value="item.count" type="number" />
                        <button @click="item.count++">+</button>
                        å°è®¡: {{ item.price * item.count }}
                </li>
            </ul>
            é‡‘é¢åˆè®¡:  {{ total }} <button v-on:click="pay()" v-bind:disabled="buyItems.length === 0">ä»˜æ¬¾</button>
            <hr/>
            è´­ç‰©è½¦æ•°æ®
            {{ cart }}
            <hr/>
            æœ€ç»ˆè¦ä¹°çš„æ•°æ®
            {{ buyItems }}
        </div>

        <script>
            new Vue({
                el: '#app',
                data: {
                    goods_list: [
                        {id: '111', name: 'è¥¿ç“œ', price: 10, unit: 'æ–¤', pic: 'ğŸ‰'},
                        {id: '222', name: 'è‘¡è„', price: 10, unit: 'æ–¤', pic: 'ğŸ‡'},
                        {id: '333', name: 'æ©™å­', price: 10, unit: 'æ–¤', pic: 'ğŸŠ'},
                        {id: '444', name: 'å“ˆå¯†ç“œ', price: 10, unit: 'æ–¤', pic: 'ğŸˆ'},
                        {id: '555', name: 'é¦™è•‰', price: 10, unit: 'æ–¤', pic: 'ğŸŒ'},
                    ],

                    cart: [
                        {id: '111', name: 'è¥¿ç“œ', price: 10, unit: 'æ–¤', pic: 'ğŸ‰', count: 2},
                        {id: '222', name: 'è‘¡è„', price: 10, unit: 'æ–¤', pic: 'ğŸ‡', count: 1},
                        {id: '333', name: 'æ©™å­', price: 10, unit: 'æ–¤', pic: 'ğŸŠ', count: 3},
                    ],

                    buyItems: []
                },
                methods: {
                    addGodosToCart(goods) {
                        // æ•°ç»„å¯¹è±¡ æœ‰ä¸€ä¸ª æ–¹æ³• å« find  ç»™ä»– ä¼ é€’ä¸€ä¸ª å›è°ƒå‡½æ•°, æˆ‘ä»¬æ¥å†³å®šè¦ä¸è¦
                        // å¦‚æœ å›è°ƒå‡½æ•° è¿”å› true  ä»£è¡¨ æ‰¾åˆ°äº†, è¿”å› å¯¹åº” å˜é‡,
                        // å¦‚æœ æœ€ç»ˆæ²¡æœ‰ è¿”å› true çš„é¡¹, æœ€ç»ˆè¿”å›ä¸€ä¸ª undefined ä»£è¡¨æ²¡æœ‰æ‰¾åˆ°
                        let item = this.cart.find((item) => {
                            return goods.id === item.id
                        });
                        // åˆ¤æ–­ item æ˜¯å¦æœ‰æ•ˆ
                        if (item) {
                            item.count++;
                        } else {
                            this.cart.push({
                                ...goods,
                                count: 1
                            });
                        }
                    },
                    decCount(item){
                        if (item.count > 1) {
                            item.count--
                        }
                    },
                    changeCount(item, event){
                        let value = event.target.value;
                        // try js çš„ä¸€ä¸ªè¯­æ³•å…³é”®å­—, è¯•å›¾å»æ‰§è¡Œ åé¢çš„ä»£ç å— {} å¦‚æœé‡Œé¢å‘ç”Ÿäº†é”™è¯¯
                        // é‚£ä¹ˆ å°†è¢« catch å…³é”®å­—æ‰€æ•è·, æˆ‘ä»¬ catch(err) {} å¤„ç†é”™è¯¯
                        try {
                            let count = parseInt(value);
                            if (Number.isNaN(count)) {
                                count = 1;
                            }
                            if (count === 0) {
                                count = 1;
                            }
                            item.count = Math.abs(count);
                            event.target.value = item.count;
                        } catch (err) {
                            // è¡¥æ•‘æ“ä½œ
                            console.log(err);
                            item.count = 1;
                        }
                    },
                    pay() {
                        console.log(this.buyItems);
                    }
                },
                computed: {
                    total() {
                        let sum = 0;
                        for (let item of this.buyItems) {
                            sum = sum + (item.price * item.count);
                        }
                        return sum;
                    }
                }
            })
        </script>
    </body>
</html>